import{l as s}from"./index-Bf-_4h4A.js";import"./three-DTQjiZ7L.js";import"./cannon-DPZWuR6y.js";class u{constructor(t){this.gameEngine=t,this.autoSaveInterval=6e4,this.lastAutoSave=Date.now(),this.quickSlots=new Array(6).fill(null),this.lastUsedSkills=[],this.currentTarget=null,this.nearbyEnemies=[],this.targetRange=50,this.autoLootEnabled=!0,this.autoLootRange=10,this.lootFilter="uncommon",this.waypoints=[],this.customMarkers=[],this.tutorialsSeen=new Set,this.hintsEnabled=!0,this.colorBlindMode=!1,this.textSize="normal",this.highContrast=!1,this.autoQuality=!0,this.targetFPS=60,this.fpsHistory=[],s.info("✨ Quality of Life System initialized")}setupAutoSave(){setInterval(()=>{this.autoSave()},this.autoSaveInterval),window.addEventListener("beforeunload",()=>{this.autoSave()}),s.info("💾 Auto-save enabled (every 60 seconds)")}autoSave(){const t={timestamp:Date.now(),player:{position:this.gameEngine.player?.position,health:this.gameEngine.player?.health,level:this.gameEngine.player?.level,xp:this.gameEngine.player?.xp},inventory:this.gameEngine.inventorySystem?.items,quests:this.gameEngine.questSystem?.activeQuests,settings:this.getSettings()};localStorage.setItem("emberveil_autosave",JSON.stringify(t)),s.info("💾 Auto-saved game state"),this.showToast("Game saved","success",2e3)}loadAutoSave(){const t=localStorage.getItem("emberveil_autosave");if(t)try{const e=JSON.parse(t);return s.info("💾 Loading auto-save from",new Date(e.timestamp)),e}catch(e){s.error("Failed to load save:",e)}return null}setupQuickActions(){this.registerShortcut("KeyH",()=>this.quickHeal()),this.registerShortcut("KeyP",()=>this.quickPotion()),this.registerShortcut("KeyX",()=>this.toggleMount()),this.registerShortcut("KeyR",()=>this.toggleAutoRun()),this.registerShortcut("KeyM",()=>this.toggleMap()),this.registerShortcut("F12",()=>this.takeScreenshot()),s.info("⌨️ Quick actions configured")}registerShortcut(t,e){window.addEventListener("keydown",i=>{i.code===t&&e()})}quickHeal(){const t=this.findBestHealingItem();t&&(this.useItem(t),this.showToast("Used "+t.name,"success"))}quickPotion(){const t=this.findBestManaPotion();t&&(this.useItem(t),this.showToast("Used "+t.name,"info"))}toggleMount(){this.gameEngine.mountSystem&&(this.gameEngine.mountSystem.isMounted?(this.gameEngine.mountSystem.dismount(),this.showToast("Dismounted","info")):(this.gameEngine.mountSystem.mount(),this.showToast("Mounted","success")))}toggleAutoRun(){this.autoRunning=!this.autoRunning,this.showToast(this.autoRunning?"Auto-run ON":"Auto-run OFF","info")}toggleMap(){window.enhancedUI&&window.enhancedUI.togglePanel("minimap")}takeScreenshot(){this.gameEngine.renderer.domElement.toBlob(e=>{const i=URL.createObjectURL(e),o=document.createElement("a");o.href=i,o.download=`emberveil_${Date.now()}.png`,o.click(),this.showToast("Screenshot saved!","success")})}updateSmartTargeting(){this.nearbyEnemies=this.findNearbyEnemies(),!this.currentTarget&&this.nearbyEnemies.length>0&&(this.currentTarget=this.nearbyEnemies[0],this.highlightTarget(this.currentTarget)),this.currentTarget&&(this.getDistanceToTarget(this.currentTarget)>this.targetRange||this.currentTarget.health<=0)&&this.clearTarget()}findNearbyEnemies(){const t=[],e=this.gameEngine.player?.position;return e?(this.gameEngine.combatEnemySystem?.enemies.forEach(i=>{const o=this.getDistance(e,i.current);o<=this.targetRange&&t.push({enemy:i,distance:o})}),t.sort((i,o)=>i.distance-o.distance),t.map(i=>i.enemy)):t}cycleTarget(){if(this.nearbyEnemies.length===0)return;const e=(this.nearbyEnemies.indexOf(this.currentTarget)+1)%this.nearbyEnemies.length;this.currentTarget=this.nearbyEnemies[e],this.highlightTarget(this.currentTarget),this.showToast("Target: "+this.currentTarget.type,"info")}highlightTarget(t){t.mesh}clearTarget(){this.currentTarget=null}setupAutoLoot(){setInterval(()=>{this.autoLootEnabled&&this.checkForLoot()},1e3),s.info("💰 Auto-loot enabled")}checkForLoot(){const t=this.gameEngine.player?.position;if(!t)return;this.findNearbyLoot(t).forEach(i=>{this.shouldAutoLoot(i)&&this.pickupLoot(i)})}findNearbyLoot(t){return[]}shouldAutoLoot(t){const e=["common","uncommon","rare","epic","legendary"],i=e.indexOf(this.lootFilter);return e.indexOf(t.rarity)>=i}pickupLoot(t){this.gameEngine.inventorySystem?.addItem(t),this.showToast(`Picked up ${t.name}`,"success",2e3)}addWaypoint(t,e){this.waypoints.push({id:Date.now(),name:t,position:e,type:"waypoint",icon:"📍"}),this.showToast(`Waypoint "${t}" added`,"success")}addCustomMarker(t,e,i="⭐"){this.customMarkers.push({id:Date.now(),name:t,position:e,type:"custom",icon:i}),this.showToast(`Marker "${t}" added`,"success")}removeMarker(t){this.waypoints=this.waypoints.filter(e=>e.id!==t),this.customMarkers=this.customMarkers.filter(e=>e.id!==t)}showTutorial(t,e,i=5e3){this.tutorialsSeen.has(t)||this.hintsEnabled&&(this.tutorialsSeen.add(t),this.showToast(`💡 Tip: ${e}`,"info",i),localStorage.setItem("tutorials_seen",JSON.stringify([...this.tutorialsSeen])))}loadSeenTutorials(){const t=localStorage.getItem("tutorials_seen");t&&(this.tutorialsSeen=new Set(JSON.parse(t)))}setColorBlindMode(t){this.colorBlindMode=t,t?(document.body.classList.add("colorblind-mode"),this.showToast("Color blind mode enabled","success")):(document.body.classList.remove("colorblind-mode"),this.showToast("Color blind mode disabled","info"))}setTextSize(t){this.textSize=t;const e={small:"14px",normal:"16px",large:"18px",xlarge:"20px"};document.documentElement.style.fontSize=e[t],this.showToast(`Text size: ${t}`,"info")}setHighContrast(t){this.highContrast=t,t?(document.body.classList.add("high-contrast"),this.showToast("High contrast enabled","success")):(document.body.classList.remove("high-contrast"),this.showToast("High contrast disabled","info"))}setupPerformanceMonitoring(){setInterval(()=>{this.monitorPerformance()},1e3),s.info("📊 Performance monitoring active")}monitorPerformance(){const t=this.getCurrentFPS();this.fpsHistory.push(t),this.fpsHistory.length>60&&this.fpsHistory.shift(),this.autoQuality&&this.adjustQuality(t)}getCurrentFPS(){return this.gameEngine.performanceOptimizer?.currentFPS||60}adjustQuality(t){const e=this.fpsHistory.reduce((i,o)=>i+o,0)/this.fpsHistory.length;e<30?this.setGraphicsQuality("low"):e<45?this.setGraphicsQuality("medium"):e>=55&&this.setGraphicsQuality("high")}setGraphicsQuality(t){s.info(`📊 Graphics quality: ${t}`),t==="low"?(this.gameEngine.renderer.shadowMap.enabled=!1,this.gameEngine.renderer.setPixelRatio(1)):t==="medium"?(this.gameEngine.renderer.shadowMap.enabled=!0,this.gameEngine.renderer.setPixelRatio(1)):t==="high"&&(this.gameEngine.renderer.shadowMap.enabled=!0,this.gameEngine.renderer.setPixelRatio(window.devicePixelRatio))}getDistance(t,e){const i=t.x-e.x,o=t.z-e.z;return Math.sqrt(i*i+o*o)}getDistanceToTarget(t){const e=this.gameEngine.player?.position;return!e||!t.current?1/0:this.getDistance(e,t.current)}findBestHealingItem(){return{name:"Health Potion",amount:50}}findBestManaPotion(){return{name:"Mana Potion",amount:50}}useItem(t){s.info("Using item:",t.name)}showToast(t,e="info",i=3e3){window.enhancedUI?window.enhancedUI.showNotification(t,e):s.info(`[${e.toUpperCase()}] ${t}`)}getSettings(){return{autoLoot:this.autoLootEnabled,lootFilter:this.lootFilter,hintsEnabled:this.hintsEnabled,colorBlindMode:this.colorBlindMode,textSize:this.textSize,highContrast:this.highContrast,autoQuality:this.autoQuality}}loadSettings(t){t&&(this.autoLootEnabled=t.autoLoot??!0,this.lootFilter=t.lootFilter??"uncommon",this.hintsEnabled=t.hintsEnabled??!0,this.setColorBlindMode(t.colorBlindMode??!1),this.setTextSize(t.textSize??"normal"),this.setHighContrast(t.highContrast??!1),this.autoQuality=t.autoQuality??!0)}initialize(){s.info("✨ Initializing Quality of Life features..."),this.setupAutoSave(),this.setupQuickActions(),this.setupAutoLoot(),this.setupPerformanceMonitoring(),this.loadSeenTutorials();const t=localStorage.getItem("qol_settings");t&&this.loadSettings(JSON.parse(t)),s.info("✅ Quality of Life system ready!"),s.info("   💾 Auto-save: Every 60 seconds"),s.info("   ⌨️ Quick actions: H (heal), P (potion), X (mount), R (auto-run)"),s.info("   🎯 Smart targeting: Tab to cycle targets"),s.info("   💰 Auto-loot: Picks up uncommon+ items"),s.info("   📍 Waypoints: Add custom markers"),s.info("   💡 Hints: Tutorial system active"),s.info("   ♿ Accessibility: Color blind mode, text size, high contrast"),s.info("   📊 Performance: Auto-adjust quality")}update(t){this.updateSmartTargeting()}}export{u as QualityOfLifeSystem};
