import{l as n}from"./index-CGDjDhhy.js";import"./three-DTQjiZ7L.js";import"./cannon-DPZWuR6y.js";class m{constructor(e,i,t,a){this.combatSystem=e,this.particleSystem=i,this.audio=t,this.ui=a,this.activeBoss=null,this.bossDefinitions=new Map,this.mechanics=new Map,this.initializeBosses()}initializeBosses(){this.bossDefinitions.set("blaze_reaper",{id:"blaze_reaper",name:"The Blaze Reaper",element:"fire",maxHealth:5e4,phases:[{threshold:1,name:"Inferno Phase",abilities:["flame_wave","fire_breath","meteor_shower"],mechanics:["flame_pools"],enrageTime:600},{threshold:.7,name:"Blazing Fury",abilities:["flame_wave","fire_breath","meteor_shower","infernal_chains"],mechanics:["flame_pools","adds_fire_elementals"],attackSpeedMultiplier:1.2},{threshold:.3,name:"Apocalyptic Flame",abilities:["flame_wave","fire_breath","meteor_shower","infernal_chains","supernova"],mechanics:["flame_pools","adds_fire_elementals","burning_ground"],attackSpeedMultiplier:1.5,damageMultiplier:1.3}]}),this.bossDefinitions.set("frostbite_colossus",{id:"frostbite_colossus",name:"Frostbite Colossus",element:"ice",maxHealth:6e4,phases:[{threshold:1,name:"Frozen Domain",abilities:["ice_shard_barrage","frost_nova","blizzard"],mechanics:["frozen_ground"]},{threshold:.6,name:"Eternal Winter",abilities:["ice_shard_barrage","frost_nova","blizzard","ice_prison"],mechanics:["frozen_ground","ice_walls"],attackSpeedMultiplier:1.3},{threshold:.2,name:"Absolute Zero",abilities:["ice_shard_barrage","frost_nova","blizzard","ice_prison","glacial_spike"],mechanics:["frozen_ground","ice_walls","freeze_aura"],attackSpeedMultiplier:1.4,damageMultiplier:1.5}]}),this.bossDefinitions.set("storm_caller",{id:"storm_caller",name:"Storm Caller",element:"lightning",maxHealth:45e3,phases:[{threshold:1,name:"Thunder Phase",abilities:["chain_lightning","thunder_strike","static_field"],mechanics:["lightning_orbs"]},{threshold:.5,name:"Tempest Rage",abilities:["chain_lightning","thunder_strike","static_field","lightning_storm"],mechanics:["lightning_orbs","adds_storm_elementals"],attackSpeedMultiplier:1.5,movementSpeed:1.3}]}),this.bossDefinitions.set("voidheart",{id:"voidheart",name:"Voidheart",element:"dark",maxHealth:55e3,phases:[{threshold:1,name:"Void Emergence",abilities:["void_bolt","dark_pulse","shadow_step"],mechanics:["void_zones"]},{threshold:.65,name:"Abyssal Power",abilities:["void_bolt","dark_pulse","shadow_step","void_rift"],mechanics:["void_zones","shadow_clones"],attackSpeedMultiplier:1.2},{threshold:.25,name:"Cosmic Horror",abilities:["void_bolt","dark_pulse","shadow_step","void_rift","reality_tear"],mechanics:["void_zones","shadow_clones","madness_aura"],attackSpeedMultiplier:1.4,damageMultiplier:1.4}]}),this.bossDefinitions.set("earthshaker",{id:"earthshaker",name:"Earthshaker",element:"earth",maxHealth:7e4,phases:[{threshold:1,name:"Stone Warden",abilities:["rock_throw","ground_slam","tremor"],mechanics:["falling_rocks"]},{threshold:.5,name:"Mountain Rage",abilities:["rock_throw","ground_slam","tremor","earthquake"],mechanics:["falling_rocks","adds_stone_golems"],attackSpeedMultiplier:1.1,defense:1.5}]}),this.bossDefinitions.set("toxic_emperor",{id:"toxic_emperor",name:"Toxic Emperor",element:"poison",maxHealth:48e3,phases:[{threshold:1,name:"Plague Bearer",abilities:["poison_spit","toxic_cloud","plague_rats"],mechanics:["poison_pools"]},{threshold:.6,name:"Pestilence",abilities:["poison_spit","toxic_cloud","plague_rats","viral_outbreak"],mechanics:["poison_pools","disease_aura"],attackSpeedMultiplier:1.3},{threshold:.3,name:"Apocalyptic Rot",abilities:["poison_spit","toxic_cloud","plague_rats","viral_outbreak","necrotic_explosion"],mechanics:["poison_pools","disease_aura","adds_plague_zombies"],attackSpeedMultiplier:1.4,damageMultiplier:1.3}]}),this.bossDefinitions.set("radiant_paladin",{id:"radiant_paladin",name:"The Fallen Paladin",element:"light",maxHealth:52e3,phases:[{threshold:1,name:"Holy Warrior",abilities:["smite","holy_shield","judgement"],mechanics:["healing_phase"]},{threshold:.4,name:"Corrupted Light",abilities:["smite","holy_shield","judgement","blinding_flash","resurrection"],mechanics:["healing_phase","summon_angels"],attackSpeedMultiplier:1.3,defense:1.4}]}),this.bossDefinitions.set("ancient_dragon",{id:"ancient_dragon",name:"Ancient Dragon",element:"fire",maxHealth:1e5,phases:[{threshold:1,name:"Dragon's Wrath",abilities:["fire_breath","tail_swipe","wing_buffet","bite"],mechanics:["flying_phase"]},{threshold:.75,name:"Elemental Mastery",abilities:["fire_breath","tail_swipe","wing_buffet","bite","frost_breath","lightning_breath"],mechanics:["flying_phase","elemental_shift"],attackSpeedMultiplier:1.2},{threshold:.5,name:"Ancient Power",abilities:["fire_breath","tail_swipe","wing_buffet","bite","frost_breath","lightning_breath","roar"],mechanics:["flying_phase","elemental_shift","adds_dragonlings"],attackSpeedMultiplier:1.3,damageMultiplier:1.2},{threshold:.2,name:"Cataclysm",abilities:["fire_breath","tail_swipe","wing_buffet","bite","frost_breath","lightning_breath","roar","meteor_storm"],mechanics:["flying_phase","elemental_shift","adds_dragonlings","enrage"],attackSpeedMultiplier:1.5,damageMultiplier:1.5,movementSpeed:1.3}]})}startBossFight(e,i=50){const t=this.bossDefinitions.get(e);if(!t)return n.error(`Boss ${e} not found`),null;const a=i/50;return this.activeBoss={definition:t,id:e,health:t.maxHealth*a,maxHealth:t.maxHealth*a,currentPhase:0,phaseData:t.phases[0],position:{x:0,y:0,z:0},isInvulnerable:!1,mechanics:new Map,startTime:Date.now(),lastAbilityTime:0,enrageTimer:t.phases[0].enrageTime||0,phaseTransitionTime:0,abilityQueue:[],currentAbility:null,attackSpeedMultiplier:1,damageMultiplier:1,defenseMultiplier:1,movementSpeed:1},this.ui&&this.ui.showBossHealthBar(t.name,this.activeBoss.health,this.activeBoss.maxHealth),this.audio&&this.audio.playMusic(`boss_${e}`,!0,!0),this.initializePhase(0),this.activeBoss}update(e){if(!this.activeBoss)return;const i=this.activeBoss,t=Date.now(),a=i.health/i.maxHealth,s=i.definition.phases.findIndex(o=>a<=o.threshold);s>i.currentPhase&&s!==-1&&this.transitionPhase(s),i.enrageTimer>0&&(t-i.startTime)/1e3>i.enrageTimer&&this.enrage(),t-i.lastAbilityTime>3e3&&!i.currentAbility&&this.selectAndExecuteAbility(),this.updateMechanics(e),this.ui&&this.ui.updateBossHealthBar(i.health,i.maxHealth)}initializePhase(e){const i=this.activeBoss,t=i.definition.phases[e];i.currentPhase=e,i.phaseData=t,i.attackSpeedMultiplier=t.attackSpeedMultiplier||1,i.damageMultiplier=t.damageMultiplier||1,i.defenseMultiplier=t.defense||1,i.movementSpeed=t.movementSpeed||1,t.mechanics.forEach(a=>{this.activateMechanic(a)}),this.particleSystem&&this.particleSystem.createEffect("phase_transition",i.position,{type:i.definition.element,count:200,lifetime:2}),this.audio&&this.audio.playSFX("boss_phase_transition",1),this.ui&&this.ui.showNotification(`${i.definition.name} enters ${t.name}!`,"boss",3e3)}transitionPhase(e){const i=this.activeBoss;i.isInvulnerable=!0,i.phaseTransitionTime=Date.now(),setTimeout(()=>{this.initializePhase(e),i.isInvulnerable=!1},2e3)}selectAndExecuteAbility(){const e=this.activeBoss,i=e.phaseData.abilities,t=i[Math.floor(Math.random()*i.length)];this.executeAbility(t),e.lastAbilityTime=Date.now()}executeAbility(e){switch(this.activeBoss,e){case"flame_wave":this.abilityFlameWave();break;case"fire_breath":this.abilityFireBreath();break;case"meteor_shower":this.abilityMeteorShower();break;case"ice_shard_barrage":this.abilityIceShardBarrage();break;case"chain_lightning":this.abilityChainLightning();break;case"void_bolt":this.abilityVoidBolt();break;default:n.warn(`Unknown ability: ${e}`)}}abilityFlameWave(){const e=this.activeBoss;this.particleSystem&&this.particleSystem.createEffect("flame_wave",e.position,{type:"fire",count:150,spread:5}),this.combatSystem.attack(e.id,"player",{attackType:"magic",damage:500*e.damageMultiplier,element:"fire",aoe:!0,aoeRadius:10})}abilityFireBreath(){const e=this.activeBoss;this.particleSystem&&this.particleSystem.createEffect("fire_breath",e.position,{type:"fire",count:300,velocity:{x:0,y:0,z:10}}),this.combatSystem.attack(e.id,"player",{attackType:"magic",damage:800*e.damageMultiplier,element:"fire",cone:!0,coneAngle:60})}abilityMeteorShower(){const e=this.activeBoss;for(let i=0;i<10;i++)setTimeout(()=>{const t={x:e.position.x+(Math.random()-.5)*20,y:e.position.y+20,z:e.position.z+(Math.random()-.5)*20};this.particleSystem&&this.particleSystem.createEffect("meteor",t,{type:"fire",count:50}),this.combatSystem.attack(e.id,"player",{attackType:"magic",damage:300*e.damageMultiplier,element:"fire",aoe:!0,aoeRadius:3,position:t})},i*500)}abilityIceShardBarrage(){const e=this.activeBoss;for(let i=0;i<5;i++)setTimeout(()=>{this.particleSystem&&this.particleSystem.createEffect("ice_shard",e.position,{type:"ice",count:30}),this.combatSystem.attack(e.id,"player",{attackType:"ranged",damage:200*e.damageMultiplier,element:"ice",projectile:!0})},i*200)}abilityChainLightning(){const e=this.activeBoss;this.particleSystem&&this.particleSystem.createEffect("chain_lightning",e.position,{type:"lightning",count:100}),this.combatSystem.attack(e.id,"player",{attackType:"magic",damage:600*e.damageMultiplier,element:"lightning",chain:!0,chainTargets:3})}abilityVoidBolt(){const e=this.activeBoss;this.particleSystem&&this.particleSystem.createEffect("void_bolt",e.position,{type:"dark",count:50}),this.combatSystem.attack(e.id,"player",{attackType:"magic",damage:700*e.damageMultiplier,element:"dark",projectile:!0})}activateMechanic(e){this.activeBoss.mechanics.set(e,{id:e,active:!0,startTime:Date.now()})}updateMechanics(e){this.activeBoss.mechanics.forEach((t,a)=>{switch(a){case"flame_pools":Date.now()-t.startTime>t.lastSpawn,t.lastSpawn=Date.now();break}})}enrage(){const e=this.activeBoss;e.attackSpeedMultiplier*=2,e.damageMultiplier*=2,e.movementSpeed*=1.5,this.ui&&this.ui.showNotification(`${e.definition.name} is ENRAGED!`,"danger",5e3),this.audio&&this.audio.playSFX("boss_enrage",1)}takeDamage(e){if(!this.activeBoss||this.activeBoss.isInvulnerable)return 0;const i=e/this.activeBoss.defenseMultiplier;return this.activeBoss.health=Math.max(0,this.activeBoss.health-i),this.activeBoss.health<=0&&this.onBossDefeat(),i}onBossDefeat(){const e=this.activeBoss;this.ui&&(this.ui.hideBossHealthBar(),this.ui.showNotification(`${e.definition.name} defeated!`,"victory",5e3)),this.audio&&(this.audio.stopMusic(),this.audio.playSFX("boss_defeat",1));const i=this.calculateRewards(e);return this.activeBoss=null,i}calculateRewards(e){const t=(Date.now()-e.startTime)/1e3<e.enrageTimer?1.5:1;return{experience:Math.floor(e.maxHealth/10*t),gold:Math.floor(e.maxHealth/5*t),items:this.generateBossLoot(e.id),achievements:[]}}generateBossLoot(e){return[{type:"legendary_weapon",bossId:e},{type:"boss_soul",bossId:e},{type:"crafting_material",rarity:"legendary",amount:5}]}getActiveBoss(){return this.activeBoss}}export{m as BossBattleMechanicsSystem};
