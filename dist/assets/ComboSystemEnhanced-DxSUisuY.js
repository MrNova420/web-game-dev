class l{constructor(){this.activeCombos=new Map,this.comboDefinitions=this.initializeComboDefinitions(),this.timingWindows={STRICT:.5,NORMAL:1,LENIENT:1.5},this.multipliers={2:1.2,3:1.5,4:2,5:2.5,6:3}}initializeComboDefinitions(){return{SWORD_BASIC_CHAIN:{name:"Basic Sword Chain",weaponType:"SWORD",sequence:["light","light","heavy"],animations:["/assets/animations/sword_slash_1.fbx","/assets/animations/sword_slash_2.fbx","/assets/animations/sword_heavy_slam.fbx"],vfx:["/assets/particles/slash_effect_1.png","/assets/particles/slash_effect_2.png","/assets/particles/impact_heavy.png"],icon:"/assets/icons/combos/sword_chain.png",timingWindow:"NORMAL",multiplier:1.5},SWORD_SPINNING_ASSAULT:{name:"Spinning Assault",weaponType:"SWORD",sequence:["light","light","spin","heavy"],animations:["/assets/animations/sword_quick_slash.fbx","/assets/animations/sword_slash_2.fbx","/assets/animations/sword_spin_360.fbx","/assets/animations/sword_overhead_slam.fbx"],vfx:["/assets/particles/quick_slash.png","/assets/particles/slash_effect.png","/assets/particles/spin_tornado.png","/assets/particles/ground_slam.png"],icon:"/assets/icons/combos/spinning_assault.png",timingWindow:"STRICT",multiplier:2,finisher:!0},AXE_CLEAVE_CHAIN:{name:"Cleave Chain",weaponType:"AXE",sequence:["heavy","heavy","spin"],animations:["/assets/animations/axe_overhead_chop.fbx","/assets/animations/axe_side_cleave.fbx","/assets/animations/axe_spin_attack.fbx"],vfx:["/assets/particles/heavy_impact.png","/assets/particles/cleave_effect.png","/assets/particles/spin_slash.png"],icon:"/assets/icons/combos/cleave_chain.png",timingWindow:"LENIENT",multiplier:2.2},SPEAR_THRUST_COMBO:{name:"Thrust Combo",weaponType:"SPEAR",sequence:["light","light","light","heavy"],animations:["/assets/animations/spear_quick_thrust.fbx","/assets/animations/spear_mid_thrust.fbx","/assets/animations/spear_high_thrust.fbx","/assets/animations/spear_piercing_lunge.fbx"],vfx:["/assets/particles/thrust_trail.png","/assets/particles/thrust_trail.png","/assets/particles/thrust_trail.png","/assets/particles/piercing_impact.png"],icon:"/assets/icons/combos/thrust_combo.png",timingWindow:"STRICT",multiplier:2},DAGGER_ASSASSINATE:{name:"Assassinate",weaponType:"DAGGER",sequence:["light","light","light","light","heavy"],animations:["/assets/animations/dagger_quick_stab_1.fbx","/assets/animations/dagger_quick_stab_2.fbx","/assets/animations/dagger_quick_stab_3.fbx","/assets/animations/dagger_quick_stab_4.fbx","/assets/animations/dagger_execute.fbx"],vfx:["/assets/particles/fast_slash.png","/assets/particles/fast_slash.png","/assets/particles/fast_slash.png","/assets/particles/fast_slash.png","/assets/particles/critical_strike.png"],icon:"/assets/icons/combos/assassinate.png",timingWindow:"STRICT",multiplier:2.5,finisher:!0},HAMMER_EARTH_SHAKER:{name:"Earth Shaker",weaponType:"HAMMER",sequence:["heavy","heavy","slam"],animations:["/assets/animations/hammer_overhead_smash.fbx","/assets/animations/hammer_side_swing.fbx","/assets/animations/hammer_ground_slam.fbx"],vfx:["/assets/particles/hammer_impact.png","/assets/particles/hammer_shockwave.png","/assets/particles/ground_rupture.png"],icon:"/assets/icons/combos/earth_shaker.png",timingWindow:"LENIENT",multiplier:2.5,aoeRadius:5},BOW_RAPID_SHOT:{name:"Rapid Shot",weaponType:"BOW",sequence:["shoot","shoot","shoot","power_shot"],animations:["/assets/animations/bow_quick_shot.fbx","/assets/animations/bow_quick_shot.fbx","/assets/animations/bow_quick_shot.fbx","/assets/animations/bow_charged_shot.fbx"],vfx:["/assets/particles/arrow_trail.png","/assets/particles/arrow_trail.png","/assets/particles/arrow_trail.png","/assets/particles/power_arrow.png"],icon:"/assets/icons/combos/rapid_shot.png",timingWindow:"NORMAL",multiplier:1.8},STAFF_MYSTIC_FLOW:{name:"Mystic Flow",weaponType:"STAFF",sequence:["spin","light","light","cast"],animations:["/assets/animations/staff_spin.fbx","/assets/animations/staff_strike_1.fbx","/assets/animations/staff_strike_2.fbx","/assets/animations/staff_magic_burst.fbx"],vfx:["/assets/particles/magic_trail.png","/assets/particles/staff_impact.png","/assets/particles/staff_impact.png","/assets/particles/magic_explosion.png"],icon:"/assets/icons/combos/mystic_flow.png",timingWindow:"NORMAL",multiplier:2},DUAL_BLADE_DANCE:{name:"Blade Dance",weaponType:"DUAL_WIELD",sequence:["left","right","left","right","both"],animations:["/assets/animations/dual_slash_left.fbx","/assets/animations/dual_slash_right.fbx","/assets/animations/dual_slash_left.fbx","/assets/animations/dual_slash_right.fbx","/assets/animations/dual_cross_slash.fbx"],vfx:["/assets/particles/left_slash.png","/assets/particles/right_slash.png","/assets/particles/left_slash.png","/assets/particles/right_slash.png","/assets/particles/cross_slash_x.png"],icon:"/assets/icons/combos/blade_dance.png",timingWindow:"STRICT",multiplier:2.5,finisher:!0},MARTIAL_FURY:{name:"Martial Fury",weaponType:"UNARMED",sequence:["punch","punch","kick","uppercut"],animations:["/assets/animations/punch_jab.fbx","/assets/animations/punch_cross.fbx","/assets/animations/kick_roundhouse.fbx","/assets/animations/uppercut_launcher.fbx"],vfx:["/assets/particles/punch_impact.png","/assets/particles/punch_impact.png","/assets/particles/kick_impact.png","/assets/particles/uppercut_burst.png"],icon:"/assets/icons/combos/martial_fury.png",timingWindow:"STRICT",multiplier:2,launcherMove:!0},GREATSWORD_TITAN_STRIKE:{name:"Titan Strike",weaponType:"GREATSWORD",sequence:["heavy","spin","heavy","slam"],animations:["/assets/animations/greatsword_overhead.fbx","/assets/animations/greatsword_360_spin.fbx","/assets/animations/greatsword_upward_slice.fbx","/assets/animations/greatsword_downward_slam.fbx"],vfx:["/assets/particles/heavy_strike.png","/assets/particles/spin_shockwave.png","/assets/particles/upward_slash.png","/assets/particles/titan_impact.png"],icon:"/assets/icons/combos/titan_strike.png",timingWindow:"LENIENT",multiplier:3,finisher:!0,aoeRadius:7}}}startCombo(s,e,t){const i={weaponType:e,sequence:[t],startTime:Date.now(),lastInputTime:Date.now(),currentMultiplier:1,hitCount:1};this.activeCombos.set(s,i),logger.info(`${s} started combo with ${e}`)}continueCombo(s,e){const t=this.activeCombos.get(s);if(!t)return logger.info(`No active combo for ${s}`),!1;const i=Date.now(),a=(i-t.lastInputTime)/1e3,o=this.findMatchingCombos(t.weaponType,[...t.sequence,e]);if(o.length===0)return logger.info("No matching combos for sequence"),this.endCombo(s),!1;const n=o[0],r=this.timingWindows[n.timingWindow];return a>r?(logger.info(`Combo timed out (${a}s > ${r}s)`),this.endCombo(s),!1):(t.sequence.push(e),t.lastInputTime=i,t.hitCount++,t.currentMultiplier=this.calculateMultiplier(t.hitCount),logger.info(`${s} combo: ${t.sequence.join(" -> ")} (${t.hitCount} hits, ${t.currentMultiplier}x)`),n.sequence.length===t.sequence.length&&this.executeComboFinisher(s,n),!0)}findMatchingCombos(s,e){const t=[];for(const[i,a]of Object.entries(this.comboDefinitions)){if(a.weaponType!==s)continue;let o=!0;for(let n=0;n<e.length;n++)if(n>=a.sequence.length||a.sequence[n]!==e[n]){o=!1;break}o&&t.push(a)}return t.sort((i,a)=>a.sequence.length-i.sequence.length)}executeComboFinisher(s,e){const t=this.activeCombos.get(s);t&&(logger.info(`${s} executed ${e.name}!`),logger.info(`  Multiplier: ${e.multiplier}x`),logger.info(`  Hit Count: ${t.hitCount}`),logger.info(`  Animations: ${e.animations.join(", ")}`),logger.info(`  VFX: ${e.vfx.join(", ")}`),logger.info(`  Icon: ${e.icon}`),e.finisher&&logger.info("  FINISHER MOVE!"),e.aoeRadius&&logger.info(`  AOE Radius: ${e.aoeRadius}m`),e.launcherMove&&logger.info("  LAUNCHER - Enemy airborne!"),this.endCombo(s))}calculateMultiplier(s){return this.multipliers[s]||this.multipliers[6]}endCombo(s){const e=this.activeCombos.get(s);if(e){const t=(Date.now()-e.startTime)/1e3;logger.info(`${s} combo ended: ${e.hitCount} hits in ${t.toFixed(2)}s`),this.activeCombos.delete(s)}}breakCombo(s){logger.info(`${s} combo broken!`),this.endCombo(s)}getActiveCombo(s){return this.activeCombos.get(s)}getComboMultiplier(s){const e=this.activeCombos.get(s);return e?e.currentMultiplier:1}canCancelAnimation(s){return this.activeCombos.get(s)?.7>=.6:!1}update(s){const e=Date.now();for(const[t,i]of this.activeCombos.entries())(e-i.lastInputTime)/1e3>2&&this.endCombo(t)}}export{l as ComboSystemEnhanced};
