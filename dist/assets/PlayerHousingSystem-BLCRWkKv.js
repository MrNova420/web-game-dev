class h{constructor(t){this.gameEngine=t,this.house={tier:1,rooms:new Map,furniture:new Map,decorations:new Map,upgrades:new Set,theme:"default",visitors:[]},this.housingTiers={1:{name:"Small Cottage",rooms:2,maxFurniture:20,cost:0},2:{name:"Cozy House",rooms:4,maxFurniture:40,cost:1e4},3:{name:"Large Villa",rooms:8,maxFurniture:80,cost:5e4},4:{name:"Manor",rooms:12,maxFurniture:150,cost:2e5},5:{name:"Mansion",rooms:20,maxFurniture:300,cost:1e6}},this.furnitureDatabase=this.createFurnitureDatabase(),this.decorationDatabase=this.createDecorationDatabase(),this.initializeStartingHouse()}initializeStartingHouse(){this.house.rooms.set("living_room",{id:"living_room",name:"Living Room",type:"living",furniture:[],decorations:[],floor:"wood",walls:"white",lighting:"normal"}),this.house.rooms.set("bedroom",{id:"bedroom",name:"Bedroom",type:"bedroom",furniture:[],decorations:[],floor:"carpet",walls:"blue",lighting:"warm"})}createFurnitureDatabase(){return{wooden_chair:{name:"Wooden Chair",type:"seating",comfort:5,cost:50,tier:1},comfy_chair:{name:"Comfy Chair",type:"seating",comfort:15,cost:200,tier:2},luxury_sofa:{name:"Luxury Sofa",type:"seating",comfort:30,cost:1e3,tier:3},small_table:{name:"Small Table",type:"table",storage:2,cost:100,tier:1},dining_table:{name:"Dining Table",type:"table",storage:4,cost:500,tier:2},grand_table:{name:"Grand Table",type:"table",storage:8,cost:2e3,tier:3},simple_bed:{name:"Simple Bed",type:"bed",rest:10,cost:200,tier:1},comfy_bed:{name:"Comfy Bed",type:"bed",rest:25,cost:1e3,tier:2},luxury_bed:{name:"Luxury Bed",type:"bed",rest:50,cost:5e3,tier:3},chest:{name:"Storage Chest",type:"storage",capacity:20,cost:150,tier:1},wardrobe:{name:"Wardrobe",type:"storage",capacity:40,cost:800,tier:2},vault:{name:"Secure Vault",type:"storage",capacity:100,cost:5e3,tier:3},workbench:{name:"Workbench",type:"crafting",bonus:.1,cost:500,tier:1},forge:{name:"Forge",type:"crafting",bonus:.2,cost:2e3,tier:2},master_station:{name:"Master Crafting Station",type:"crafting",bonus:.5,cost:1e4,tier:3},training_dummy:{name:"Training Dummy",type:"utility",feature:"training",cost:1e3,tier:2},bookshelf:{name:"Bookshelf",type:"utility",feature:"learning",cost:500,tier:1},meditation_mat:{name:"Meditation Mat",type:"utility",feature:"meditation",cost:800,tier:2},grow_station:{name:"Indoor Garden",type:"utility",feature:"gardening",cost:2e3,tier:3}}}createDecorationDatabase(){return{painting_basic:{name:"Basic Painting",type:"wall",beauty:5,cost:100,tier:1},painting_masterpiece:{name:"Masterpiece Painting",type:"wall",beauty:25,cost:5e3,tier:3},tapestry:{name:"Tapestry",type:"wall",beauty:15,cost:800,tier:2},rug_small:{name:"Small Rug",type:"floor",beauty:3,cost:50,tier:1},rug_large:{name:"Large Rug",type:"floor",beauty:10,cost:500,tier:2},carpet_luxury:{name:"Luxury Carpet",type:"floor",beauty:20,cost:2e3,tier:3},potted_plant:{name:"Potted Plant",type:"plant",beauty:5,cost:80,tier:1},bonsai:{name:"Bonsai Tree",type:"plant",beauty:15,cost:500,tier:2},indoor_tree:{name:"Indoor Tree",type:"plant",beauty:30,cost:2e3,tier:3},candle:{name:"Candle",type:"lighting",beauty:2,cost:20,tier:1},chandelier:{name:"Chandelier",type:"lighting",beauty:20,cost:3e3,tier:3},magic_orb:{name:"Magic Orb Light",type:"lighting",beauty:15,cost:1e3,tier:2}}}upgradeHouse(t){const e=this.housingTiers[t];if(!e)return{success:!1,message:"Invalid tier"};if(t<=this.house.tier)return{success:!1,message:"Already at this tier or higher"};if(this.gameEngine.economySystem){if(!this.gameEngine.economySystem.canAfford(e.cost))return{success:!1,message:"Not enough gold"};this.gameEngine.economySystem.spendGold(e.cost)}return this.house.tier=t,logger.info(`🏠 Upgraded to ${e.name}!`),{success:!0,tier:e}}addRoom(t,e){const r=this.housingTiers[this.house.tier];if(this.house.rooms.size>=r.rooms)return{success:!1,message:"Max rooms reached for current tier"};if(this.house.rooms.has(t))return{success:!1,message:"Room already exists"};const s=1e3*this.house.rooms.size;if(this.gameEngine.economySystem){if(!this.gameEngine.economySystem.canAfford(s))return{success:!1,message:"Not enough gold"};this.gameEngine.economySystem.spendGold(s)}const o={id:t,name:e.name||"New Room",type:e.type||"general",furniture:[],decorations:[],floor:"wood",walls:"white",lighting:"normal"};return this.house.rooms.set(t,o),{success:!0,room:o}}placeFurniture(t,e,r){const s=this.house.rooms.get(t);if(!s)return{success:!1,message:"Room not found"};const o=this.furnitureDatabase[e];if(!o)return{success:!1,message:"Furniture not found"};const a=this.housingTiers[this.house.tier];if(Array.from(this.house.rooms.values()).reduce((c,m)=>c+m.furniture.length,0)>=a.maxFurniture)return{success:!1,message:"Max furniture reached"};const u=`furniture_${e}_${Date.now()}`,n={id:u,furnitureId:e,data:o,position:r||{x:0,y:0,z:0},rotation:0,placedDate:Date.now()};return s.furniture.push(n),this.house.furniture.set(u,n),{success:!0,furniture:n}}removeFurniture(t,e){const r=this.house.rooms.get(t);if(!r)return{success:!1,message:"Room not found"};const s=r.furniture.findIndex(o=>o.id===e);return s===-1?{success:!1,message:"Furniture not found in room"}:(r.furniture.splice(s,1),this.house.furniture.delete(e),{success:!0})}placeDecoration(t,e,r){const s=this.house.rooms.get(t);if(!s)return{success:!1,message:"Room not found"};const o=this.decorationDatabase[e];if(!o)return{success:!1,message:"Decoration not found"};const a=`decoration_${e}_${Date.now()}`,i={id:a,decorationId:e,data:o,position:r||{x:0,y:0,z:0},rotation:0,placedDate:Date.now()};return s.decorations.push(i),this.house.decorations.set(a,i),{success:!0,decoration:i}}changeRoomTheme(t,e){const r=this.house.rooms.get(t);return r?(r.floor=e.floor||r.floor,r.walls=e.walls||r.walls,r.lighting=e.lighting||r.lighting,{success:!0}):{success:!1,message:"Room not found"}}calculateBeauty(){let t=0;for(const e of this.house.rooms.values()){for(const r of e.furniture)t+=r.data.comfort||0;for(const r of e.decorations)t+=r.data.beauty||0}return t}calculateComfort(){let t=0;for(const e of this.house.rooms.values())for(const r of e.furniture)t+=r.data.comfort||0,t+=r.data.rest||0;return t}useFeature(t){for(const e of this.house.furniture.values())if(e.data.feature===t)switch(t){case"training":return this.useTrainingDummy();case"meditation":return this.useMeditation();case"gardening":return this.useGarden();case"learning":return this.useBookshelf()}return{success:!1,message:"Feature not available"}}useTrainingDummy(){return logger.info("💪 Training complete!"),{success:!0,reward:"xp"}}useMeditation(){return this.gameEngine.player&&(this.gameEngine.player.hp=this.gameEngine.player.maxHP,this.gameEngine.player.mana=this.gameEngine.player.maxMana),logger.info("🧘 Meditation complete - fully restored!"),{success:!0,reward:"restore"}}useGarden(){return logger.info("🌱 Garden tended!"),{success:!0,reward:"herbs"}}useBookshelf(){return logger.info("📚 Knowledge gained!"),{success:!0,reward:"knowledge"}}inviteVisitor(t){return this.house.visitors.length>=10?{success:!1,message:"Max visitors reached"}:(this.house.visitors.push({id:t,arrivedTime:Date.now()}),{success:!0})}getStats(){return{tier:this.house.tier,tierData:this.housingTiers[this.house.tier],roomCount:this.house.rooms.size,furnitureCount:Array.from(this.house.rooms.values()).reduce((t,e)=>t+e.furniture.length,0),decorationCount:Array.from(this.house.rooms.values()).reduce((t,e)=>t+e.decorations.length,0),beauty:this.calculateBeauty(),comfort:this.calculateComfort(),visitors:this.house.visitors.length}}getRoom(t){return this.house.rooms.get(t)}getAllRooms(){return Array.from(this.house.rooms.values())}save(){const t={tier:this.house.tier,rooms:Array.from(this.house.rooms.entries()),furniture:Array.from(this.house.furniture.entries()),decorations:Array.from(this.house.decorations.entries()),upgrades:Array.from(this.house.upgrades),theme:this.house.theme};localStorage.setItem("player_house",JSON.stringify(t))}load(){const t=localStorage.getItem("player_house");if(t)try{const e=JSON.parse(t);this.house.tier=e.tier||1,this.house.rooms=new Map(e.rooms||[]),this.house.furniture=new Map(e.furniture||[]),this.house.decorations=new Map(e.decorations||[]),this.house.upgrades=new Set(e.upgrades||[]),this.house.theme=e.theme||"default"}catch(e){logger.error("Failed to load house data:",e)}}}export{h as PlayerHousingSystem};
