class n{constructor(t){this.gameEngine=t,this.autoSaveInterval=6e4,this.lastAutoSave=Date.now(),this.quickSlots=new Array(6).fill(null),this.lastUsedSkills=[],this.currentTarget=null,this.nearbyEnemies=[],this.targetRange=50,this.autoLootEnabled=!0,this.autoLootRange=10,this.lootFilter="uncommon",this.waypoints=[],this.customMarkers=[],this.tutorialsSeen=new Set,this.hintsEnabled=!0,this.colorBlindMode=!1,this.textSize="normal",this.highContrast=!1,this.autoQuality=!0,this.targetFPS=60,this.fpsHistory=[],console.log("‚ú® Quality of Life System initialized")}setupAutoSave(){setInterval(()=>{this.autoSave()},this.autoSaveInterval),window.addEventListener("beforeunload",()=>{this.autoSave()}),console.log("üíæ Auto-save enabled (every 60 seconds)")}autoSave(){const t={timestamp:Date.now(),player:{position:this.gameEngine.player?.position,health:this.gameEngine.player?.health,level:this.gameEngine.player?.level,xp:this.gameEngine.player?.xp},inventory:this.gameEngine.inventorySystem?.items,quests:this.gameEngine.questSystem?.activeQuests,settings:this.getSettings()};localStorage.setItem("emberveil_autosave",JSON.stringify(t)),console.log("üíæ Auto-saved game state"),this.showToast("Game saved","success",2e3)}loadAutoSave(){const t=localStorage.getItem("emberveil_autosave");if(t)try{const e=JSON.parse(t);return console.log("üíæ Loading auto-save from",new Date(e.timestamp)),e}catch(e){console.error("Failed to load save:",e)}return null}setupQuickActions(){this.registerShortcut("KeyH",()=>this.quickHeal()),this.registerShortcut("KeyP",()=>this.quickPotion()),this.registerShortcut("KeyX",()=>this.toggleMount()),this.registerShortcut("KeyR",()=>this.toggleAutoRun()),this.registerShortcut("KeyM",()=>this.toggleMap()),this.registerShortcut("F12",()=>this.takeScreenshot()),console.log("‚å®Ô∏è Quick actions configured")}registerShortcut(t,e){window.addEventListener("keydown",s=>{s.code===t&&e()})}quickHeal(){const t=this.findBestHealingItem();t&&(this.useItem(t),this.showToast("Used "+t.name,"success"))}quickPotion(){const t=this.findBestManaPotion();t&&(this.useItem(t),this.showToast("Used "+t.name,"info"))}toggleMount(){this.gameEngine.mountSystem&&(this.gameEngine.mountSystem.isMounted?(this.gameEngine.mountSystem.dismount(),this.showToast("Dismounted","info")):(this.gameEngine.mountSystem.mount(),this.showToast("Mounted","success")))}toggleAutoRun(){this.autoRunning=!this.autoRunning,this.showToast(this.autoRunning?"Auto-run ON":"Auto-run OFF","info")}toggleMap(){window.enhancedUI&&window.enhancedUI.togglePanel("minimap")}takeScreenshot(){this.gameEngine.renderer.domElement.toBlob(e=>{const s=URL.createObjectURL(e),i=document.createElement("a");i.href=s,i.download=`emberveil_${Date.now()}.png`,i.click(),this.showToast("Screenshot saved!","success")})}updateSmartTargeting(){this.nearbyEnemies=this.findNearbyEnemies(),!this.currentTarget&&this.nearbyEnemies.length>0&&(this.currentTarget=this.nearbyEnemies[0],this.highlightTarget(this.currentTarget)),this.currentTarget&&(this.getDistanceToTarget(this.currentTarget)>this.targetRange||this.currentTarget.health<=0)&&this.clearTarget()}findNearbyEnemies(){const t=[],e=this.gameEngine.player?.position;return e?(this.gameEngine.combatEnemySystem?.enemies.forEach(s=>{const i=this.getDistance(e,s.current);i<=this.targetRange&&t.push({enemy:s,distance:i})}),t.sort((s,i)=>s.distance-i.distance),t.map(s=>s.enemy)):t}cycleTarget(){if(this.nearbyEnemies.length===0)return;const e=(this.nearbyEnemies.indexOf(this.currentTarget)+1)%this.nearbyEnemies.length;this.currentTarget=this.nearbyEnemies[e],this.highlightTarget(this.currentTarget),this.showToast("Target: "+this.currentTarget.type,"info")}highlightTarget(t){t.mesh}clearTarget(){this.currentTarget=null}setupAutoLoot(){setInterval(()=>{this.autoLootEnabled&&this.checkForLoot()},1e3),console.log("üí∞ Auto-loot enabled")}checkForLoot(){const t=this.gameEngine.player?.position;if(!t)return;this.findNearbyLoot(t).forEach(s=>{this.shouldAutoLoot(s)&&this.pickupLoot(s)})}findNearbyLoot(t){return[]}shouldAutoLoot(t){const e=["common","uncommon","rare","epic","legendary"],s=e.indexOf(this.lootFilter);return e.indexOf(t.rarity)>=s}pickupLoot(t){this.gameEngine.inventorySystem?.addItem(t),this.showToast(`Picked up ${t.name}`,"success",2e3)}addWaypoint(t,e){this.waypoints.push({id:Date.now(),name:t,position:e,type:"waypoint",icon:"üìç"}),this.showToast(`Waypoint "${t}" added`,"success")}addCustomMarker(t,e,s="‚≠ê"){this.customMarkers.push({id:Date.now(),name:t,position:e,type:"custom",icon:s}),this.showToast(`Marker "${t}" added`,"success")}removeMarker(t){this.waypoints=this.waypoints.filter(e=>e.id!==t),this.customMarkers=this.customMarkers.filter(e=>e.id!==t)}showTutorial(t,e,s=5e3){this.tutorialsSeen.has(t)||this.hintsEnabled&&(this.tutorialsSeen.add(t),this.showToast(`üí° Tip: ${e}`,"info",s),localStorage.setItem("tutorials_seen",JSON.stringify([...this.tutorialsSeen])))}loadSeenTutorials(){const t=localStorage.getItem("tutorials_seen");t&&(this.tutorialsSeen=new Set(JSON.parse(t)))}setColorBlindMode(t){this.colorBlindMode=t,t?(document.body.classList.add("colorblind-mode"),this.showToast("Color blind mode enabled","success")):(document.body.classList.remove("colorblind-mode"),this.showToast("Color blind mode disabled","info"))}setTextSize(t){this.textSize=t;const e={small:"14px",normal:"16px",large:"18px",xlarge:"20px"};document.documentElement.style.fontSize=e[t],this.showToast(`Text size: ${t}`,"info")}setHighContrast(t){this.highContrast=t,t?(document.body.classList.add("high-contrast"),this.showToast("High contrast enabled","success")):(document.body.classList.remove("high-contrast"),this.showToast("High contrast disabled","info"))}setupPerformanceMonitoring(){setInterval(()=>{this.monitorPerformance()},1e3),console.log("üìä Performance monitoring active")}monitorPerformance(){const t=this.getCurrentFPS();this.fpsHistory.push(t),this.fpsHistory.length>60&&this.fpsHistory.shift(),this.autoQuality&&this.adjustQuality(t)}getCurrentFPS(){return this.gameEngine.performanceOptimizer?.currentFPS||60}adjustQuality(t){const e=this.fpsHistory.reduce((s,i)=>s+i,0)/this.fpsHistory.length;e<30?this.setGraphicsQuality("low"):e<45?this.setGraphicsQuality("medium"):e>=55&&this.setGraphicsQuality("high")}setGraphicsQuality(t){console.log(`üìä Graphics quality: ${t}`),t==="low"?(this.gameEngine.renderer.shadowMap.enabled=!1,this.gameEngine.renderer.setPixelRatio(1)):t==="medium"?(this.gameEngine.renderer.shadowMap.enabled=!0,this.gameEngine.renderer.setPixelRatio(1)):t==="high"&&(this.gameEngine.renderer.shadowMap.enabled=!0,this.gameEngine.renderer.setPixelRatio(window.devicePixelRatio))}getDistance(t,e){const s=t.x-e.x,i=t.z-e.z;return Math.sqrt(s*s+i*i)}getDistanceToTarget(t){const e=this.gameEngine.player?.position;return!e||!t.current?1/0:this.getDistance(e,t.current)}findBestHealingItem(){return{name:"Health Potion",amount:50}}findBestManaPotion(){return{name:"Mana Potion",amount:50}}useItem(t){console.log("Using item:",t.name)}showToast(t,e="info",s=3e3){window.enhancedUI?window.enhancedUI.showNotification(t,e):console.log(`[${e.toUpperCase()}] ${t}`)}getSettings(){return{autoLoot:this.autoLootEnabled,lootFilter:this.lootFilter,hintsEnabled:this.hintsEnabled,colorBlindMode:this.colorBlindMode,textSize:this.textSize,highContrast:this.highContrast,autoQuality:this.autoQuality}}loadSettings(t){t&&(this.autoLootEnabled=t.autoLoot??!0,this.lootFilter=t.lootFilter??"uncommon",this.hintsEnabled=t.hintsEnabled??!0,this.setColorBlindMode(t.colorBlindMode??!1),this.setTextSize(t.textSize??"normal"),this.setHighContrast(t.highContrast??!1),this.autoQuality=t.autoQuality??!0)}initialize(){console.log("‚ú® Initializing Quality of Life features..."),this.setupAutoSave(),this.setupQuickActions(),this.setupAutoLoot(),this.setupPerformanceMonitoring(),this.loadSeenTutorials();const t=localStorage.getItem("qol_settings");t&&this.loadSettings(JSON.parse(t)),console.log("‚úÖ Quality of Life system ready!"),console.log("   üíæ Auto-save: Every 60 seconds"),console.log("   ‚å®Ô∏è Quick actions: H (heal), P (potion), X (mount), R (auto-run)"),console.log("   üéØ Smart targeting: Tab to cycle targets"),console.log("   üí∞ Auto-loot: Picks up uncommon+ items"),console.log("   üìç Waypoints: Add custom markers"),console.log("   üí° Hints: Tutorial system active"),console.log("   ‚ôø Accessibility: Color blind mode, text size, high contrast"),console.log("   üìä Performance: Auto-adjust quality")}update(t){this.updateSmartTargeting()}}export{n as QualityOfLifeSystem};
