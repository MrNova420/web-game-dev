class g{constructor(){this.activeEffects=new Map,this.effectDefinitions=this.initializeEffectDefinitions(),this.immunities=new Map,this.resistances=new Map}initializeEffectDefinitions(){return{BURNING:{name:"Burning",type:"dot",icon:"/assets/icons/status/burning.png",particle:"/assets/particles/fire_dot.png",overlay:"/assets/textures/overlays/burning.png",color:16729344,damagePerTick:10,tickRate:1,maxStacks:5,visualScale:1.2},POISONED:{name:"Poisoned",type:"dot",icon:"/assets/icons/status/poisoned.png",particle:"/assets/particles/poison_bubbles.png",overlay:"/assets/textures/overlays/poisoned.png",color:65280,damagePerTick:5,tickRate:.5,maxStacks:10,visualScale:1},BLEEDING:{name:"Bleeding",type:"dot",icon:"/assets/icons/status/bleeding.png",particle:"/assets/particles/blood_drip.png",overlay:"/assets/textures/overlays/bleeding.png",color:9109504,damagePerTick:8,tickRate:1,maxStacks:3,visualScale:.8},FROZEN:{name:"Frozen",type:"control",icon:"/assets/icons/status/frozen.png",particle:"/assets/particles/ice_crystals.png",overlay:"/assets/textures/overlays/frozen.png",animation:"/assets/animations/frozen_idle.fbx",color:65535,movementSpeedMultiplier:0,attackSpeedMultiplier:0,maxStacks:1,visualScale:1.5},STUNNED:{name:"Stunned",type:"control",icon:"/assets/icons/status/stunned.png",particle:"/assets/particles/stars_spinning.png",overlay:"/assets/textures/overlays/stunned.png",animation:"/assets/animations/stunned.fbx",color:16776960,disableActions:!0,maxStacks:1,visualScale:1},ROOTED:{name:"Rooted",type:"control",icon:"/assets/icons/status/rooted.png",particle:"/assets/particles/vines.png",overlay:"/assets/textures/overlays/rooted.png",color:2263842,movementSpeedMultiplier:0,maxStacks:1,visualScale:1},SLEEPING:{name:"Sleeping",type:"control",icon:"/assets/icons/status/sleeping.png",particle:"/assets/particles/zzz.png",overlay:"/assets/textures/overlays/sleeping.png",animation:"/assets/animations/sleep.fbx",color:9662683,disableActions:!0,breaksOnDamage:!0,maxStacks:1,visualScale:.8},FEARED:{name:"Feared",type:"control",icon:"/assets/icons/status/feared.png",particle:"/assets/particles/fear_aura.png",overlay:"/assets/textures/overlays/feared.png",animation:"/assets/animations/fear_run.fbx",color:4915330,forcedMovement:"away",disableAttacks:!0,maxStacks:1,visualScale:1},WEAKENED:{name:"Weakened",type:"debuff",icon:"/assets/icons/status/weakened.png",particle:"/assets/particles/down_arrow.png",overlay:"/assets/textures/overlays/weakened.png",color:9127187,damageMultiplier:.7,maxStacks:3,visualScale:.8},SLOWED:{name:"Slowed",type:"debuff",icon:"/assets/icons/status/slowed.png",particle:"/assets/particles/slow_effect.png",overlay:"/assets/textures/overlays/slowed.png",color:4620980,movementSpeedMultiplier:.5,attackSpeedMultiplier:.7,maxStacks:5,visualScale:1},BLINDED:{name:"Blinded",type:"debuff",icon:"/assets/icons/status/blinded.png",particle:"/assets/particles/darkness.png",overlay:"/assets/textures/overlays/blinded.png",color:0,accuracyMultiplier:.3,visionRange:2,maxStacks:1,visualScale:1.5},SILENCED:{name:"Silenced",type:"debuff",icon:"/assets/icons/status/silenced.png",particle:"/assets/particles/silence_symbol.png",overlay:"/assets/textures/overlays/silenced.png",color:6908265,disableSkills:!0,maxStacks:1,visualScale:1},CURSED:{name:"Cursed",type:"debuff",icon:"/assets/icons/status/cursed.png",particle:"/assets/particles/dark_aura.png",overlay:"/assets/textures/overlays/cursed.png",color:9109643,healingMultiplier:.5,damageMultiplier:.8,maxStacks:1,visualScale:1.2},HASTE:{name:"Haste",type:"buff",icon:"/assets/icons/status/haste.png",particle:"/assets/particles/speed_lines.png",overlay:"/assets/textures/overlays/haste.png",color:16766720,movementSpeedMultiplier:1.5,attackSpeedMultiplier:1.3,maxStacks:3,visualScale:1},SHIELDED:{name:"Shielded",type:"buff",icon:"/assets/icons/status/shielded.png",particle:"/assets/particles/shield_glow.png",overlay:"/assets/textures/overlays/shielded.png",color:2003199,absorbAmount:100,maxStacks:1,visualScale:1.3},REGENERATING:{name:"Regenerating",type:"buff",icon:"/assets/icons/status/regenerating.png",particle:"/assets/particles/heal_plus.png",overlay:"/assets/textures/overlays/regenerating.png",color:65280,healPerTick:10,tickRate:1,maxStacks:5,visualScale:1},EMPOWERED:{name:"Empowered",type:"buff",icon:"/assets/icons/status/empowered.png",particle:"/assets/particles/power_aura.png",overlay:"/assets/textures/overlays/empowered.png",color:16737095,damageMultiplier:1.5,maxStacks:3,visualScale:1.2},FORTIFIED:{name:"Fortified",type:"buff",icon:"/assets/icons/status/fortified.png",particle:"/assets/particles/armor_up.png",overlay:"/assets/textures/overlays/fortified.png",color:12632256,defenseMultiplier:1.5,maxStacks:3,visualScale:1},INVISIBLE:{name:"Invisible",type:"buff",icon:"/assets/icons/status/invisible.png",particle:"/assets/particles/invisibility.png",overlay:"/assets/textures/overlays/invisible.png",color:16777215,opacity:.3,breaksOnAttack:!0,maxStacks:1,visualScale:.5},ELECTRIFIED:{name:"Electrified",type:"elemental",icon:"/assets/icons/status/electrified.png",particle:"/assets/particles/lightning_sparks.png",overlay:"/assets/textures/overlays/electrified.png",color:49151,damagePerTick:15,tickRate:.5,chainToNearby:!0,chainRadius:5,maxStacks:3,visualScale:1.2},CORRODED:{name:"Corroded",type:"elemental",icon:"/assets/icons/status/corroded.png",particle:"/assets/particles/acid_drip.png",overlay:"/assets/textures/overlays/corroded.png",color:10145074,armorReduction:.2,damagePerTick:7,tickRate:1,maxStacks:5,visualScale:1},CHILLED:{name:"Chilled",type:"elemental",icon:"/assets/icons/status/chilled.png",particle:"/assets/particles/frost.png",overlay:"/assets/textures/overlays/chilled.png",color:11393254,movementSpeedMultiplier:.7,attackSpeedMultiplier:.8,maxStacks:3,freezeThreshold:3,visualScale:1},HOLY_FIRE:{name:"Holy Fire",type:"elemental",icon:"/assets/icons/status/holy_fire.png",particle:"/assets/particles/holy_flame.png",overlay:"/assets/textures/overlays/holy_fire.png",color:16777184,damagePerTick:20,tickRate:1,bonusVsUndead:2,maxStacks:1,visualScale:1.5},MARKED:{name:"Marked",type:"special",icon:"/assets/icons/status/marked.png",particle:"/assets/particles/target_mark.png",overlay:"/assets/textures/overlays/marked.png",color:16711680,damageAmplification:1.3,revealsStealth:!0,maxStacks:1,visualScale:1},INSPIRED:{name:"Inspired",type:"special",icon:"/assets/icons/status/inspired.png",particle:"/assets/particles/inspiration.png",overlay:"/assets/textures/overlays/inspired.png",color:16766720,experienceMultiplier:1.5,critChanceBonus:.1,maxStacks:1,visualScale:1.2},EXHAUSTED:{name:"Exhausted",type:"special",icon:"/assets/icons/status/exhausted.png",particle:"/assets/particles/exhaustion.png",overlay:"/assets/textures/overlays/exhausted.png",color:8421504,allStatsMultiplier:.7,staminaRegenMultiplier:.5,maxStacks:3,visualScale:.8},BERSERK:{name:"Berserk",type:"special",icon:"/assets/icons/status/berserk.png",particle:"/assets/particles/rage_aura.png",overlay:"/assets/textures/overlays/berserk.png",animation:"/assets/animations/berserk_idle.fbx",color:16711680,damageMultiplier:2,defenseMultiplier:.5,attackSpeedMultiplier:1.5,disableSkills:!0,maxStacks:1,visualScale:1.5},TAUNT:{name:"Taunted",type:"special",icon:"/assets/icons/status/taunted.png",particle:"/assets/particles/taunt_effect.png",overlay:"/assets/textures/overlays/taunted.png",color:16753920,forcedTarget:!0,maxStacks:1,visualScale:1}}}applyEffect(e,s,t,i,a=1){const n=this.effectDefinitions[s];if(!n)return logger.error(`Unknown effect type: ${s}`),!1;if(this.hasImmunity(e,s))return logger.info(`${e} is immune to ${s}`),!1;const c=this.getResistance(e,s),l=t*(1-c);if(l<=0)return!1;this.activeEffects.has(e)||this.activeEffects.set(e,[]);const o=this.activeEffects.get(e),r=o.find(p=>p.type===s);return r?(r.duration=Math.max(r.duration,l),r.stacks=Math.min(r.stacks+a,n.maxStacks),r.lastTick=Date.now()):o.push({type:s,definition:n,duration:l,stacks:Math.min(a,n.maxStacks),source:i,startTime:Date.now(),lastTick:Date.now()}),this.createVisualEffects(e,s),!0}removeEffect(e,s){const t=this.activeEffects.get(e);if(!t)return;const i=t.findIndex(a=>a.type===s);i>=0&&(t.splice(i,1),this.removeVisualEffects(e,s))}createVisualEffects(e,s){const t=this.effectDefinitions[s];logger.info(`Creating visual effects for ${e}: ${s}`),logger.info(`  Icon: ${t.icon}`),logger.info(`  Particle: ${t.particle}`),logger.info(`  Overlay: ${t.overlay}`),t.animation&&logger.info(`  Animation: ${t.animation}`)}removeVisualEffects(e,s){logger.info(`Removing visual effects for ${e}: ${s}`)}update(e){const s=Date.now();for(const[t,i]of this.activeEffects.entries())for(let a=i.length-1;a>=0;a--){const n=i[a];n.duration-=e,n.definition.tickRate&&(s-n.lastTick)/1e3>=n.definition.tickRate&&(this.processTick(t,n),n.lastTick=s),n.duration<=0&&this.removeEffect(t,n.type)}}processTick(e,s){const t=s.definition,i=s.stacks;if(t.damagePerTick){const a=t.damagePerTick*i;logger.info(`${e} takes ${a} damage from ${s.type}`)}if(t.healPerTick){const a=t.healPerTick*i;logger.info(`${e} heals ${a} from ${s.type}`)}t.chainToNearby&&Math.random()<.3&&logger.info(`${s.type} chains to nearby entities`)}hasImmunity(e,s){const t=this.immunities.get(e);return t&&t.has(s)}getResistance(e,s){const t=this.resistances.get(e);return t&&t[s]||0}setImmunity(e,s){this.immunities.has(e)||this.immunities.set(e,new Set),this.immunities.get(e).add(s)}setResistance(e,s,t){this.resistances.has(e)||this.resistances.set(e,{}),this.resistances.get(e)[s]=Math.min(t,.9)}cleanse(e,s=["debuff","control","dot"]){const t=this.activeEffects.get(e);if(!t)return 0;let i=0;for(let a=t.length-1;a>=0;a--)s.includes(t[a].definition.type)&&(this.removeEffect(e,t[a].type),i++);return i}getActiveEffects(e){return this.activeEffects.get(e)||[]}hasEffect(e,s){const t=this.activeEffects.get(e);return t&&t.some(i=>i.type===s)}}export{g as StatusEffectSystemVisual};
