import{l as e}from"./index-Bf-_4h4A.js";import"./three-DTQjiZ7L.js";import"./cannon-DPZWuR6y.js";class _{constructor(){this.activeCombos=new Map,this.comboDefinitions=this.initializeComboDefinitions(),this.timingWindows={STRICT:.5,NORMAL:1,LENIENT:1.5},this.multipliers={2:1.2,3:1.5,4:2,5:2.5,6:3}}initializeComboDefinitions(){return{SWORD_BASIC_CHAIN:{name:"Basic Sword Chain",weaponType:"SWORD",sequence:["light","light","heavy"],animations:["/assets/animations/sword_slash_1.fbx","/assets/animations/sword_slash_2.fbx","/assets/animations/sword_heavy_slam.fbx"],vfx:["/assets/particles/slash_effect_1.png","/assets/particles/slash_effect_2.png","/assets/particles/impact_heavy.png"],icon:"/assets/icons/combos/sword_chain.png",timingWindow:"NORMAL",multiplier:1.5},SWORD_SPINNING_ASSAULT:{name:"Spinning Assault",weaponType:"SWORD",sequence:["light","light","spin","heavy"],animations:["/assets/animations/sword_quick_slash.fbx","/assets/animations/sword_slash_2.fbx","/assets/animations/sword_spin_360.fbx","/assets/animations/sword_overhead_slam.fbx"],vfx:["/assets/particles/quick_slash.png","/assets/particles/slash_effect.png","/assets/particles/spin_tornado.png","/assets/particles/ground_slam.png"],icon:"/assets/icons/combos/spinning_assault.png",timingWindow:"STRICT",multiplier:2,finisher:!0},AXE_CLEAVE_CHAIN:{name:"Cleave Chain",weaponType:"AXE",sequence:["heavy","heavy","spin"],animations:["/assets/animations/axe_overhead_chop.fbx","/assets/animations/axe_side_cleave.fbx","/assets/animations/axe_spin_attack.fbx"],vfx:["/assets/particles/heavy_impact.png","/assets/particles/cleave_effect.png","/assets/particles/spin_slash.png"],icon:"/assets/icons/combos/cleave_chain.png",timingWindow:"LENIENT",multiplier:2.2},SPEAR_THRUST_COMBO:{name:"Thrust Combo",weaponType:"SPEAR",sequence:["light","light","light","heavy"],animations:["/assets/animations/spear_quick_thrust.fbx","/assets/animations/spear_mid_thrust.fbx","/assets/animations/spear_high_thrust.fbx","/assets/animations/spear_piercing_lunge.fbx"],vfx:["/assets/particles/thrust_trail.png","/assets/particles/thrust_trail.png","/assets/particles/thrust_trail.png","/assets/particles/piercing_impact.png"],icon:"/assets/icons/combos/thrust_combo.png",timingWindow:"STRICT",multiplier:2},DAGGER_ASSASSINATE:{name:"Assassinate",weaponType:"DAGGER",sequence:["light","light","light","light","heavy"],animations:["/assets/animations/dagger_quick_stab_1.fbx","/assets/animations/dagger_quick_stab_2.fbx","/assets/animations/dagger_quick_stab_3.fbx","/assets/animations/dagger_quick_stab_4.fbx","/assets/animations/dagger_execute.fbx"],vfx:["/assets/particles/fast_slash.png","/assets/particles/fast_slash.png","/assets/particles/fast_slash.png","/assets/particles/fast_slash.png","/assets/particles/critical_strike.png"],icon:"/assets/icons/combos/assassinate.png",timingWindow:"STRICT",multiplier:2.5,finisher:!0},HAMMER_EARTH_SHAKER:{name:"Earth Shaker",weaponType:"HAMMER",sequence:["heavy","heavy","slam"],animations:["/assets/animations/hammer_overhead_smash.fbx","/assets/animations/hammer_side_swing.fbx","/assets/animations/hammer_ground_slam.fbx"],vfx:["/assets/particles/hammer_impact.png","/assets/particles/hammer_shockwave.png","/assets/particles/ground_rupture.png"],icon:"/assets/icons/combos/earth_shaker.png",timingWindow:"LENIENT",multiplier:2.5,aoeRadius:5},BOW_RAPID_SHOT:{name:"Rapid Shot",weaponType:"BOW",sequence:["shoot","shoot","shoot","power_shot"],animations:["/assets/animations/bow_quick_shot.fbx","/assets/animations/bow_quick_shot.fbx","/assets/animations/bow_quick_shot.fbx","/assets/animations/bow_charged_shot.fbx"],vfx:["/assets/particles/arrow_trail.png","/assets/particles/arrow_trail.png","/assets/particles/arrow_trail.png","/assets/particles/power_arrow.png"],icon:"/assets/icons/combos/rapid_shot.png",timingWindow:"NORMAL",multiplier:1.8},STAFF_MYSTIC_FLOW:{name:"Mystic Flow",weaponType:"STAFF",sequence:["spin","light","light","cast"],animations:["/assets/animations/staff_spin.fbx","/assets/animations/staff_strike_1.fbx","/assets/animations/staff_strike_2.fbx","/assets/animations/staff_magic_burst.fbx"],vfx:["/assets/particles/magic_trail.png","/assets/particles/staff_impact.png","/assets/particles/staff_impact.png","/assets/particles/magic_explosion.png"],icon:"/assets/icons/combos/mystic_flow.png",timingWindow:"NORMAL",multiplier:2},DUAL_BLADE_DANCE:{name:"Blade Dance",weaponType:"DUAL_WIELD",sequence:["left","right","left","right","both"],animations:["/assets/animations/dual_slash_left.fbx","/assets/animations/dual_slash_right.fbx","/assets/animations/dual_slash_left.fbx","/assets/animations/dual_slash_right.fbx","/assets/animations/dual_cross_slash.fbx"],vfx:["/assets/particles/left_slash.png","/assets/particles/right_slash.png","/assets/particles/left_slash.png","/assets/particles/right_slash.png","/assets/particles/cross_slash_x.png"],icon:"/assets/icons/combos/blade_dance.png",timingWindow:"STRICT",multiplier:2.5,finisher:!0},MARTIAL_FURY:{name:"Martial Fury",weaponType:"UNARMED",sequence:["punch","punch","kick","uppercut"],animations:["/assets/animations/punch_jab.fbx","/assets/animations/punch_cross.fbx","/assets/animations/kick_roundhouse.fbx","/assets/animations/uppercut_launcher.fbx"],vfx:["/assets/particles/punch_impact.png","/assets/particles/punch_impact.png","/assets/particles/kick_impact.png","/assets/particles/uppercut_burst.png"],icon:"/assets/icons/combos/martial_fury.png",timingWindow:"STRICT",multiplier:2,launcherMove:!0},GREATSWORD_TITAN_STRIKE:{name:"Titan Strike",weaponType:"GREATSWORD",sequence:["heavy","spin","heavy","slam"],animations:["/assets/animations/greatsword_overhead.fbx","/assets/animations/greatsword_360_spin.fbx","/assets/animations/greatsword_upward_slice.fbx","/assets/animations/greatsword_downward_slam.fbx"],vfx:["/assets/particles/heavy_strike.png","/assets/particles/spin_shockwave.png","/assets/particles/upward_slash.png","/assets/particles/titan_impact.png"],icon:"/assets/icons/combos/titan_strike.png",timingWindow:"LENIENT",multiplier:3,finisher:!0,aoeRadius:7}}}startCombo(s,t,a){const n={weaponType:t,sequence:[a],startTime:Date.now(),lastInputTime:Date.now(),currentMultiplier:1,hitCount:1};this.activeCombos.set(s,n),e.info(`${s} started combo with ${t}`)}continueCombo(s,t){const a=this.activeCombos.get(s);if(!a)return e.info(`No active combo for ${s}`),!1;const n=Date.now(),i=(n-a.lastInputTime)/1e3,r=this.findMatchingCombos(a.weaponType,[...a.sequence,t]);if(r.length===0)return e.info("No matching combos for sequence"),this.endCombo(s),!1;const o=r[0],c=this.timingWindows[o.timingWindow];return i>c?(e.info(`Combo timed out (${i}s > ${c}s)`),this.endCombo(s),!1):(a.sequence.push(t),a.lastInputTime=n,a.hitCount++,a.currentMultiplier=this.calculateMultiplier(a.hitCount),e.info(`${s} combo: ${a.sequence.join(" -> ")} (${a.hitCount} hits, ${a.currentMultiplier}x)`),o.sequence.length===a.sequence.length&&this.executeComboFinisher(s,o),!0)}findMatchingCombos(s,t){const a=[];for(const[n,i]of Object.entries(this.comboDefinitions)){if(i.weaponType!==s)continue;let r=!0;for(let o=0;o<t.length;o++)if(o>=i.sequence.length||i.sequence[o]!==t[o]){r=!1;break}r&&a.push(i)}return a.sort((n,i)=>i.sequence.length-n.sequence.length)}executeComboFinisher(s,t){const a=this.activeCombos.get(s);a&&(e.info(`${s} executed ${t.name}!`),e.info(`  Multiplier: ${t.multiplier}x`),e.info(`  Hit Count: ${a.hitCount}`),e.info(`  Animations: ${t.animations.join(", ")}`),e.info(`  VFX: ${t.vfx.join(", ")}`),e.info(`  Icon: ${t.icon}`),t.finisher&&e.info("  FINISHER MOVE!"),t.aoeRadius&&e.info(`  AOE Radius: ${t.aoeRadius}m`),t.launcherMove&&e.info("  LAUNCHER - Enemy airborne!"),this.endCombo(s))}calculateMultiplier(s){return this.multipliers[s]||this.multipliers[6]}endCombo(s){const t=this.activeCombos.get(s);if(t){const a=(Date.now()-t.startTime)/1e3;e.info(`${s} combo ended: ${t.hitCount} hits in ${a.toFixed(2)}s`),this.activeCombos.delete(s)}}breakCombo(s){e.info(`${s} combo broken!`),this.endCombo(s)}getActiveCombo(s){return this.activeCombos.get(s)}getComboMultiplier(s){const t=this.activeCombos.get(s);return t?t.currentMultiplier:1}canCancelAnimation(s){return this.activeCombos.get(s)?.7>=.6:!1}update(s){const t=Date.now();for(const[a,n]of this.activeCombos.entries())(t-n.lastInputTime)/1e3>2&&this.endCombo(a)}}export{_ as ComboSystemEnhanced};
