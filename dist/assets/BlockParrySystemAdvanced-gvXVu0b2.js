import{l as a}from"./index-CGDjDhhy.js";import"./three-DTQjiZ7L.js";import"./cannon-DPZWuR6y.js";class l{constructor(){this.blockingEntities=new Map,this.parryWindows=new Map,this.perfectParryWindow=200,this.blockStaminaCost=10,this.parryStaminaCost=15,this.animations={block_front:"/assets/animations/shield_block_front.fbx",block_left:"/assets/animations/shield_block_left.fbx",block_right:"/assets/animations/shield_block_right.fbx",parry_perfect:"/assets/animations/parry_perfect.fbx",guard_break:"/assets/animations/guard_break.fbx",shield_bash:"/assets/animations/shield_bash.fbx",counter_slash:"/assets/animations/counter_attack.fbx"},this.vfx={block_sparks:"/assets/particles/block_sparks.png",parry_flash:"/assets/particles/parry_flash.png",perfect_parry:"/assets/particles/perfect_parry_burst.png",guard_shatter:"/assets/particles/guard_break_effect.png",shield_impact:"/assets/particles/shield_bash_impact.png"},this.icons={blocking:"/assets/icons/combat/blocking.png",parry_ready:"/assets/icons/combat/parry_ready.png",guard_broken:"/assets/icons/combat/guard_broken.png"}}startBlocking(s,t="front"){const i=this.animations[`block_${t}`];a.info(`${s} starts blocking ${t}: ${i}`),this.blockingEntities.set(s,{direction:t,startTime:Date.now(),stamina:100,canParry:!0})}attemptParry(s){const t=Date.now();this.parryWindows.set(s,{startTime:t,endTime:t+this.perfectParryWindow}),a.info(`${s} attempts parry (${this.perfectParryWindow}ms window)`),a.info(`  Animation: ${this.animations.parry_perfect}`)}checkParry(s,t){const i=this.parryWindows.get(s);if(!i)return{success:!1};const r=Math.abs(t-i.startTime);return r<=this.perfectParryWindow?(a.info(`${s} PERFECT PARRY! (${r}ms)`),a.info(`  VFX: ${this.vfx.perfect_parry}`),this.parryWindows.delete(s),{success:!0,perfect:!0,counterWindowOpen:!0,damageReflected:.5}):{success:!1}}shieldBash(s,t){return a.info(`${s} shield bash -> ${t}`),a.info(`  Animation: ${this.animations.shield_bash}`),a.info(`  VFX: ${this.vfx.shield_impact}`),{damage:50,stunDuration:1.5}}guardBreak(s,t){const i=this.blockingEntities.get(t);return i&&i.stamina<=0?(a.info(`${t} guard broken!`),a.info(`  Animation: ${this.animations.guard_break}`),a.info(`  VFX: ${this.vfx.guard_shatter}`),this.blockingEntities.delete(t),!0):!1}stopBlocking(s){this.blockingEntities.delete(s),a.info(`${s} stops blocking`)}update(s){const t=Date.now();for(const[i,r]of this.parryWindows.entries())t>r.endTime&&this.parryWindows.delete(i);for(const[i,r]of this.blockingEntities.entries())r.stamina-=this.blockStaminaCost*s,r.stamina<=0&&this.guardBreak(null,i)}}export{l as BlockParrySystemAdvanced};
