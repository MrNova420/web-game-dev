import{l as r}from"./index-Bf-_4h4A.js";import"./three-DTQjiZ7L.js";import"./cannon-DPZWuR6y.js";class m{constructor(t,e,i,a,n){this.scene=t,this.terrainSystem=e,this.weatherSystem=i,this.textureManager=a,this.soundManager=n,this.biomes={forest:this.createBiomeConfig("forest",{textures:["grass","dirt","moss"],vegetation:["tree","bush","flower"],weatherPatterns:["clear","rain"],lighting:{ambient:.6,tint:{r:.9,g:1,b:.9}},fogColor:{r:.7,g:.8,b:.7},ambientSound:"forest"}),darkForest:this.createBiomeConfig("darkForest",{textures:["dark_grass","dark_dirt","dark_moss"],vegetation:["dead_tree","thorns","mushroom"],weatherPatterns:["fog","rain"],lighting:{ambient:.3,tint:{r:.6,g:.6,b:.7}},fogColor:{r:.4,g:.4,b:.5},ambientSound:"dark_forest"}),plains:this.createBiomeConfig("plains",{textures:["grass","dirt"],vegetation:["grass_tuft","wildflower"],weatherPatterns:["clear","rain"],lighting:{ambient:.9,tint:{r:1,g:1,b:1}},fogColor:{r:.8,g:.9,b:1},ambientSound:"wind_soft"}),grasslands:this.createBiomeConfig("grasslands",{textures:["tall_grass","dirt"],vegetation:["tall_grass","wheat"],weatherPatterns:["clear","rain"],lighting:{ambient:.9,tint:{r:1,g:1,b:.95}},fogColor:{r:.8,g:.9,b:1},ambientSound:"grassland"}),mountains:this.createBiomeConfig("mountains",{textures:["rock","snow","stone"],vegetation:["pine","rock_formation"],weatherPatterns:["clear","snow","blizzard"],lighting:{ambient:.8,tint:{r:.95,g:.95,b:1}},fogColor:{r:.8,g:.85,b:.9},ambientSound:"wind_mountain"}),snowyPeaks:this.createBiomeConfig("snowyPeaks",{textures:["snow","ice","rock"],vegetation:["ice_crystal","frozen_tree"],weatherPatterns:["snow","blizzard"],lighting:{ambient:1,tint:{r:.9,g:.95,b:1}},fogColor:{r:.9,g:.95,b:1},ambientSound:"blizzard"}),desert:this.createBiomeConfig("desert",{textures:["sand","sandstone"],vegetation:["cactus","dead_bush"],weatherPatterns:["clear","sandstorm"],lighting:{ambient:1,tint:{r:1,g:.95,b:.8}},fogColor:{r:.9,g:.8,b:.6},ambientSound:"desert"}),swamp:this.createBiomeConfig("swamp",{textures:["mud","murky_water","moss"],vegetation:["willow","cattail","lily_pad"],weatherPatterns:["fog","rain"],lighting:{ambient:.5,tint:{r:.7,g:.8,b:.7}},fogColor:{r:.5,g:.6,b:.5},ambientSound:"swamp"}),volcano:this.createBiomeConfig("volcano",{textures:["lava_rock","ash","obsidian"],vegetation:["dead_tree","lava_crystal"],weatherPatterns:["clear","storm"],lighting:{ambient:.7,tint:{r:1,g:.7,b:.5}},fogColor:{r:.5,g:.3,b:.2},ambientSound:"volcano"}),tundra:this.createBiomeConfig("tundra",{textures:["snow","ice","frozen_dirt"],vegetation:["ice_spike","frozen_bush"],weatherPatterns:["snow","blizzard"],lighting:{ambient:.9,tint:{r:.9,g:.95,b:1}},fogColor:{r:.9,g:.95,b:1},ambientSound:"tundra"}),enchantedForest:this.createBiomeConfig("enchantedForest",{textures:["glowing_grass","magical_dirt","crystal"],vegetation:["glowing_tree","magic_flower","crystal"],weatherPatterns:["clear"],lighting:{ambient:.7,tint:{r:.8,g:.9,b:1}},fogColor:{r:.6,g:.7,b:.9},ambientSound:"magical"}),crystalCaverns:this.createBiomeConfig("crystalCaverns",{textures:["crystal","glowing_stone","cave_floor"],vegetation:["crystal_formation","glowing_mushroom"],weatherPatterns:["clear"],lighting:{ambient:.4,tint:{r:.7,g:.8,b:1}},fogColor:{r:.3,g:.4,b:.6},ambientSound:"cavern"})},this.activeBiomes=new Map,this.biomeBlendDistance=50,this.initialize()}initialize(){r.info("[BiomeRenderingSystem] Initializing biome system..."),r.info(`[BiomeRenderingSystem] ${Object.keys(this.biomes).length} biomes available`)}createBiomeConfig(t,e){return{id:t,textures:e.textures||[],vegetation:e.vegetation||[],weatherPatterns:e.weatherPatterns||["clear"],lighting:e.lighting||{ambient:.8,tint:{r:1,g:1,b:1}},fogColor:e.fogColor||{r:.8,g:.9,b:1},fogDensity:e.fogDensity||.001,ambientSound:e.ambientSound||null,particleEffects:e.particleEffects||[]}}getBiomeAt(t,e){const i=Math.sqrt(t*t+e*e);return i<200?this.biomes.plains:i<500?this.biomes.forest:i<1e3?this.biomes.mountains:this.biomes.snowyPeaks}applyBiome(t,e){const i=`${Math.floor(t.x/100)},${Math.floor(t.z/100)}`;this.activeBiomes.has(i)&&this.activeBiomes.get(i).id===e.id||(this.activeBiomes.set(i,e),r.info(`[BiomeRenderingSystem] Applied biome ${e.id} at (${t.x}, ${t.z})`),this.applyBiomeEffects(e))}applyBiomeEffects(t){this.applyBiomeLighting(t),this.applyBiomeFog(t),this.applyBiomeWeather(t),this.applyBiomeSound(t),this.loadBiomeTextures(t)}applyBiomeLighting(t){r.info(`[BiomeRenderingSystem] Applying lighting for ${t.id}`)}applyBiomeFog(t){this.scene.fog&&(this.scene.fog.density=t.fogDensity)}applyBiomeWeather(t){if(this.weatherSystem&&t.weatherPatterns.length>0){const e=t.weatherPatterns[Math.floor(Math.random()*t.weatherPatterns.length)];this.weatherSystem.setWeather(e,3)}}applyBiomeSound(t){this.soundManager&&t.ambientSound&&this.soundManager.playAmbient(t.ambientSound,!0)}async loadBiomeTextures(t){if(this.textureManager)for(const e of t.textures)await this.textureManager.loadTerrainMaterial(e,{x:50,y:50})}update(t){const e=this.getBiomeAt(t.x,t.z);this.applyBiome(t,e)}getBiomeList(){return Object.keys(this.biomes)}getBiome(t){return this.biomes[t]}dispose(){this.activeBiomes.clear(),r.info("[BiomeRenderingSystem] Disposed")}}export{m as BiomeRenderingSystem};
